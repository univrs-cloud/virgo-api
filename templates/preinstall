#!/bin/bash

set -o pipefail

if ! ischroot; then
	latest_version=$(/usr/local/bin/n ls-remote 22 2>/dev/null | grep -oE '[0-9]+\.[0-9]+\.[0-9]+' | head -1)
	installed_versions=$(/usr/local/bin/node -v 2>/dev/null | grep -oE '[0-9]+\.[0-9]+\.[0-9]+' | head -1)
	if echo "$installed_versions" | grep -qx "$latest_version"; then
		echo "Node $latest_version is already installed. Nothing no update."
	else
		echo "Updating Node..."
		/usr/local/bin/n 22
		/usr/local/bin/n prune
		echo "Node updated."
	fi
fi

file_path="/etc/mail.rc"
line_to_add="set mta=/usr/bin/msmtp"
if ! grep -Fxq "$line_to_add" "$file_path"; then
	echo "$line_to_add" >> "$file_path"
fi

#debconf-set-selections <<EOF
#msmtp msmtp/apparmor boolean false
#EOF
#apt install msmtp-mta -y
